# Descomplicando os Secrets e ConfigMaps no Kubernetes
### 08.1. O que são as Secrets no Kubernetes?
Os Secrets fornecem uma maneira segura e flexível de gerenciar informações sensíveis, como senhas, tokens OAuth, chaves SSH e outros dados que você não quer expor nas configurações de seus aplicativos.

Um Secret é um objeto que contém um pequeno volume de informações sensíveis, como uma senha, um token ou uma chave. Essas informações podem ser consumidas por Pods ou usadas pelo sistema para realizar ações em nome de um Pod.
 
**Como os Secrets funcionam.**  
Os Secrets são armazenados no Etcd, o armazenamento de dados distribuído do Kubernetes. Por padrão, eles são armazenados sem criptografia, embora o Etcd suporte criptografia para proteger os dados armazenados nele. Além disso, o acesso aos Secrets é restrito por meio de Role-Based Access Control (RBAC), o que permite controlar quais usuários e Pods podem acessar quais Secrets.
Os Secrets podem ser montados em Pods como arquivos em volumes ou podem ser usados para preencher variáveis de ambiente para um container dentro de um Pod. Quando um Secret é atualizado, o Kubernetes não atualiza automaticamente os volumes montados ou as variáveis de ambiente que se referem a ele.

### 08.2. Conhecendo todos os tipos de Secrets e o que é a codificação base64.  
Ao criar um Secret, você pode especificar o seu tipo utilizando o campo type do objeto Secret, ou algumas opções de linha de comando equivalentes no comando kubectl, quando disponíveis. O campo type de um Secret é utilizado para facilitar a manipulação programática de diferentes tipos de dados confidenciais.

O Kubernetes oferece vários tipos embutidos de Secret para casos de uso comuns. Estes tipos variam em termos de validações efetuadas e limitações que o Kubernetes impõe neles.

Abaixo, a tabela com os tipos de secrets e os principais casos de uso:
<p align="center"><img width="572" height="185" alt="image" src="https://github.com/user-attachments/assets/626cde78-82a2-4550-b524-7ac560f7d26c" /></p>

Veja a documentação completa na página do Kubernetes na seção [Secrets](https://kubernetes.io/pt-br/docs/concepts/configuration/secret/).

**Base64.**  
Base64 é um método de codificação que converte dados binários (como imagens, áudios ou documentos) em uma string de texto ASCII composta por 64 caracteres seguros (A-Z, a-z, 0-9, +, / e = para preenchimento). Ele é usado para transmitir dados binários com segurança em sistemas que suportam apenas texto, como e-mails (MIME) e arquivos JSON/HTML, sem corrupção.

Para codificar um texto no Linux, use o comando **base64**, como no exemplo abaixo:
<p align="center"><img width="296" height="52" alt="image" src="https://github.com/user-attachments/assets/76c1631b-a599-4933-9648-ed4b659ae146" /></p>

### 08.3. Criando um Secret do tipo Opaque.  
Para criar um secret do tipo Opaque, inicie simulando um usuário e senha codificados com base64:

* echo -n "MySecret" | base64  
* echo -n "brsouza" | base64  

Agora, crie o arquivo **08_primeiro_secret.yaml** com o conteúdo abaixo:
<p align="center"><img width="204" height="134" alt="image" src="https://github.com/user-attachments/assets/803340f2-ef1b-47a3-bf59-3072ce51e28f" /></p>

Abaixo, a explicação dos parâmetros:

* **apiVersion**: define a versão da API do Kubernetes usada.  
* **kind**: diz ao Kubernetes que este objeto é um **Secret**.  
* **metadata**: informações relacionadas ao Secret.  
  * **name**: nome do **Secret**.  
* **type**: tipo do Secret, nesse caso, **Opaque**.  
* **data**: dados que serão armazenados no Secret.  
  * **username**: resultado do comando **echo -n "MySecret" | base64**  
  * **password**: resultado do comando **echo -n "brsouza" | base64**  

**Para aplicar essa configuração, execute**: kubectl apply -f 08_primeiro_secret.yaml  
**Para ver os secrets criados, execute**: kubectl get secrets  
**Para ver detalhes do secrets, execute**: kubectl describe secrets  

**Criando um secret manualmente.**  
**Para criar um secret manualmente, execute**: kubectl create secret generic secret-test **--from-literal**=username=brsouza **--from-literal**=password=MySecret

Abaixo, a explicação dos parâmetros:

* **generic**: usando generic, será criado uma secret do tipo Opaque.  
* **secret-test**: nome da Secret.  
* **--from-literal**: será usado informações passadas na linha de comando no formato chave=valor.  

### 08.4. Utilizando o nosso Secret dentro de um Pod.  
Para utilizar um Secret em um Pod, crie o arquivo **08_pod_secret.yaml** com o conteúdo abaixo:  
<p align="center"><img width="269" height="309" alt="image" src="https://github.com/user-attachments/assets/95ac780c-a726-46b9-ba47-035014c295c4" /></p>

Abaixo, os principais parâmetros dessa configuração.

* **env**:  variáveis de ambiente que serão informados ao Pod.  
* **name**: nome da variável de ambiente dentro do container.  
* **valueFrom**: indica que o valor não é fixo, vem de uma fonte externa.  
* **secretKeyRef**: diz que a fonte é um Secret do Kubernetes.  
* **name**: nome da Secret.  
* **key**: a chave dentro da Secret.  

**Para aplicar essa configuração, execute**: kubectl apply -f 08_pod_secret.yaml  

Executando **kubectl describe pod pod-secret**, é possível visualizar as variáveis de ambiente criados nesse pod.  
<p align="center"><img width="569" height="47" alt="image" src="https://github.com/user-attachments/assets/d489ef41-f478-43b2-b5e6-779eaab3a2c2" /></p>

E acessando o container com **kubectl exec -it pod-secret -- bash** é possível visualizar as variáveis de ambiente com o comando **set**.
<p align="center"><img width="420" height="51" alt="image" src="https://github.com/user-attachments/assets/d45ef953-e972-4885-9f66-dc8c9d1cdbfd" /></p>
